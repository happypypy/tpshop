<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui"/>
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
	<meta name="format-detection" content="telephone=no, email=no"/>
	<meta charset="UTF-8">
	<title>购物车</title>
	<link rel="stylesheet" href="__PUBLIC__/Home/css/core.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/icon.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/home.css">
	<link rel="icon" type="image/x-icon" href="favicon.ico">
	<link href="iTunesArtwork@2x.png" sizes="114x114" rel="apple-touch-icon-precomposed">
    <script src="__PUBLIC__/Home/js/jquery.min.1.8.2.js" type="text/javascript"></script>
</head>
<body>

	<header class="aui-header-default aui-header-fixed aui-header-bg">
		<a href="javascript:history.back(-1)" class="aui-header-item">
			<i class="aui-icon aui-icon-back-white"></i>
		</a>
		<div class="aui-header-center aui-header-center-clear">
			<div class="aui-header-center-logo">
				<div class="aui-car-white-Typeface">购物车({$count})</div>
			</div>
		</div>
		<a href="#" class="aui-header-item-icon"   style="min-width:0">
			<i class="aui-icon aui-icon-member"></i>
		</a>
	</header>
	<section class="aui-car-content">
		<div class="aui-car-box">
			<div class="aui-car-box-name">
				<input type="checkbox" class="check goods-check shopCheck">
				<h3>
					<a href="#">优购优品网</a>
				</h3>
				<div class="aui-car-coupons">
					<a href="#">领券</a>
					<!--<a href="#">编辑</a>-->
				</div>
			</div>
			<div class="aui-car-box-list">
                <foreach name="cart" item="v">
				<ul>
					<li>
						<div class="aui-car-box-list-item">
							<input type="checkbox" class="check check{$v.gid} goods-check goodsCheck">
							<div class="aui-car-box-list-img">
								<a href="{:U('Index/goodsdata')}?id={$v.id}">
									<img src="__PUBLIC__/Upload/goods/{$v.pic}" alt="">
								</a>
							</div>

							<div class="aui-car-box-list-text">
								<h4>
									<a href="ui-product.html">{$v.goodsname}</a>
								</h4>
								<!--<div class="aui-car-box-list-text-brief">-->
									<!--&lt;!&ndash;<span>重量:3.3kg</span>&ndash;&gt;-->
									<!--&lt;!&ndash;<span>颜色:标配版</span>&ndash;&gt;-->
									<!--&lt;!&ndash;<span>版本:5.7英寸</span>&ndash;&gt;-->
								<!--</div>-->
								<div class="aui-car-box-list-text-price">
									<div class="aui-car-box-list-text-pri">
										￥<b class="sale" id="sale">{$v['sale']}</b>
									</div>
									<div class="aui-car-box-list-text-arithmetic">
										<a href="javascript:;" class="minus" onclick="minus({$v.gid},{$v.sale})" >-</a>
										<span class="num" name="num" id="num{$v.gid}">{$v['num']}</span>
										<a href="javascript:;" class="plus" onclick="plus({$v.gid},{$v.sale})" >+</a>
                                        <div><br/>
                                        <div><a href="javascript:;" class="del" gid="{$v.gid}" style="color:red">删除</a>
									</div>
								</div>
							</div>
						</div>

                        </div>

                        </div>
					</li>

				</ul>
                </foreach>
			</div>

		</div>
	</section>
	<div class="aui-payment-bar">
		<div class="all-checkbox"><input type="checkbox" class="check goods-check" id="AllCheck">全选</div>
		<div class="shop-total">
			<strong>合计：<i class="total" id="total">0</i></strong>
		</div>
		<a href="order.html" class="settlement">结算</a>
	</div>
	<script src="__PUBLIC__/Home/js/jquery.min.js"></script>
	<script src="__PUBLIC__/Home/js/aui-car.js"></script>

</body>
</html>

<script>
    //商品删除
$(".del").click(function(){
    obj=$(this);
    //发出请求
    gid=obj.attr('gid');
    $.get("{:U('Shopping/delcart')}",{"gid":gid},function(res){
        if(res==1){
            //执行删除操作
            console.log("删除成功");
            obj.parent().parent().parent().parent().parent().parent().parent().remove();
        }else if(res==2){
            console.log("删除失败");
        }
    },"text");
});


   // 减少商品
    function minus(gid,sale){
       obj=$(this);
       url="{:U('Shopping/minus')}";
        $.get(url,{gid:gid},function(res){
            if(res==1){
                if($(".check"+gid).attr('checked')=='checked'){
                    total=total-sale;
                    $("#total").text(total)
                }
                num=$("#num"+gid).val();
                num--;
                if(num<1){
                    if($(".check"+gid).attr('checked')=='checked'){
                        $("#total").text(total)
                    }
                    num=1;
                }
                $("#num"+gid).val(num);
                $("#sale"+gid).text(num*sale);
            }
        },'text');
    }

    //增加
    function plus(gid,sale){
        obj=$(this);
        url="{:U('Shopping/plus')}";
        $.get(url,{gid:gid},function(res){
            if(res==1){
                if($(".check"+gid).attr('checked')=='checked'){
                    total=total-sale;
                    $("#total").text(total)
                }
                num=$("#num"+gid).val();
                num++;
                if(num<1){
                    if($(".check"+gid).attr('checked')=='checked'){
                        $("#total").text(total)
                    }
                    num=1;
                }
                $("#num"+gid).val(num);
                $("#sale"+gid).text(num*sale);
            }
        },'text');
    }

</script>